

----------------
 install
----------------

1. Easist way on Ubuntu 18 or 20
(https://www.cyberithub.com/how-to-install-harbor-on-ubuntu-20-04-lts-step-by-step/)


    (1) requirements: docker, docker-compose 


    (2) Harbor download from github
        wget https://github.com/goharbor/harbor/releases/download/v2.4.1/harbor-offline-installer-v2.4.1.tgz
        tar -xvzf harbor-offline-installer-v2.4.1.tgz
        cd harbor
        cp harbor.yml.tmpl harbor.yml
        nano harbor.yml (or vim)
            -- hostname: harbor.example.com
            -- port: 80 (or 8080 whatever it's available)
            -- harbor_admin_password: Harbor12345
            -- comment-out all HTTPS settings


    (3) install Harbor
        harbor# ./install.sh


    (4) Open UI
        - open webbrower, and go to the hostname that was modified at harbor.yml
        - access with admin, admin_password(Harbor12345)
        - create a new user
        - login a new user 
        - go to project, make a new project or just use 'library' default project


    (5) Pull & Push
        use with the image name
             vmware-063.antd.nist.gov:8080/library/<image>






2. from Official Site
(https://goharbor.io/docs/1.10/install-config/run-installer-script/)

2.1 Installation with Chart Repository Service
    sudo ./install.sh --with-chartmuseum


2.2 Installation with Notary, Clair, and Chart Repository Service
    sudo ./install.sh --with-notary --with-clair --with-chartmuseum





3. Configure HTTPS access to Harbor
(https://goharbor.io/docs/2.0.0/install-config/configure-https/)
(https://www.techrepublic.com/article/how-to-install-harbor-on-ubuntu-server-18-04/)

    (1) 



---------------------
 Docker Client setup
---------------------
(https://goharbor.io/docs/1.10/install-config/run-installer-script/#connect-http)

1. Connecting to Harbor via HTTP

    IMPORTANT: If your installation of Harbor uses HTTP rather than HTTPS, 
                you must add the option --insecure-registry to your clientâ€™s Docker daemon. 
                By default, the daemon file is located at /etc/docker/daemon.json.

    For example, add the following to your daemon.json file:

      {
      "insecure-registries" : ["myregistrydomain.com:5000", "0.0.0.0"]
      }

    After you update daemon.json, you must restart both Docker Engine and Harbor.

    (1) Restart Docker Engine.

        systemctl restart docker


    (2) Stop Harbor.

        docker-compose down -v


    (3)Restart Harbor.

        docker-compose up -d


  (*) in my case, not necessary to restart Harbor at all




2. some errors

  vmware-005 $ docker login vmware-063.antd.nist.gov:8080
  Username: kyehwanl
  Password:
  Error response from daemon: Get "https://vmware-063.antd.nist.gov:8080/v2/": http: server gave HTTP response to HTTPS client


  --> This means Docker client in vmware-005 has a setting for only accepting HTTPS connection,
        So, need to make daemon.json file under /etc/docker/ with 
            { 
            "insecure-registries" : ["vmware-063.antd.nist.gov:8080"] 
            }

        And then, restart docker 

          sudo systemctl daemon-reload ( <-- is it really necessary ?) 
          sudo systemctl restart docker








3. Running logs

  vmware-005 $ docker login vmware-063.antd.nist.gov:8080
  Username: kyehwanl
  Password:
  WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
  Configure a credential helper to remove this warning. See
  https://docs.docker.com/engine/reference/commandline/login/#credentials-store

  Login Succeeded


  vmware-005 [2012]{/etc/docker}$ docker pull vmware-063.antd.nist.gov:8080/library/busybox-test1
  Using default tag: latest
  latest: Pulling from library/busybox-test1
  50783e0dfb64: Pull complete
  Digest: sha256:98de1ad411c6d08e50f26f392f3bc6cd65f686469b7c22a85c7b5fb1b820c154
  Status: Downloaded newer image for vmware-063.antd.nist.gov:8080/library/busybox-test1:latest
  vmware-063.antd.nist.gov:8080/library/busybox-test1:latest


  vmware-005 $ docker images
  REPOSITORY                                            TAG       IMAGE ID       CREATED         SIZE
  vmware-063.antd.nist.gov:8080/library/busybox-test1   latest    7a80323521cc   3 weeks ago     1.24MB
  nist/srx-grpc                                         1.2-614   efb4a39b7608   8 months ago    1.68GB
  ...


  vmware-005 $ docker run --rm -it vmware-063.antd.nist.gov:8080/library/busybox-test1 /bin/sh
  / # ls /etc/
  group        hostname     hosts        localtime    mtab         network      passwd       resolv.conf  shadow
  / # exit
